insert into MATCH (TUR, DATE, TEAM1, TEAM2, TOTAL1, TOTAL2)
values(1, '28.07.2018 16:30', 'Урал', 'Анжи', 0 , 1), (1, '28.07.2018 19:00', 'Спартак', 'Оренбург', 1 , 0), (1, '28.07.2018 21:30', 'Ростов', 'Ахмат', 1 , 0), (1, '29.07.2018 14:00', 'Енисей', 'Зенит', 0 , 2), (1, '29.07.2018 16:30', 'Арсенал', 'Динамо', 0 , 0), (1, '29.07.2018 19:00', 'Рубин', 'Краснодар', 2 , 1), (1, '30.07.2018 18:00', 'Уфа', 'Локомотив', 0 , 0), (1, '31.07.2018 19:00', 'Крылья Советов', 'ЦСКА', 0 , 0), (2, '03.08.2018 19:30', 'Динамо', 'Рубин', 1 , 1),(2, '04.08.2018 14:00', 'Урал', 'Краснодар', 1 , 2),(2, '04.08.2018 16:30', 'Зенит', 'Арсенал', 1 , 0),(2, '04.08.2018 19:00', 'Локомотив', 'Спартак', 0 , 0), (2, '05.08.2018 16:30', 'Крылья Советов', 'Оренбург', 0 , 3), (2, '05.08.2018 19:00', 'ЦСКА', 'Ростов', 0 , 1),(2, '05.08.2018 21:30', 'Ахмат', 'Енисей', 1 , 0), (2, '06.08.2018 17:30', 'Уфа', 'Анжи', 3 , 0),(3, '10.08.2018 17:30', 'Урал', 'Динамо', 1 , 1), (3, '11.08.2018 16:30', 'Енисей', 'ЦСКА', 1 , 1),(3, '11.08.2018 19:00', 'Спартак', 'Анжи', 1 , 0), (3, '11.08.2018 21:30', 'Ростов', 'Крылья Советов', 0 , 1 ),(3, '12.08.2018 14:00', 'Оренбург', 'Локомотив', 1 , 0),(3, '12.08.2018 16:30', 'Арсенал', 'Ахмат', 3 , 1 ),(3, '13.08.2018 17:30', 'Уфа', 'Краснодар',0 , 1 ),(3, '13.08.2018 20:00', 'Рубин', 'Зенит', 0 , 1 ),(4, '17.08.2018 19:30', 'Анжи', 'Оренбург', 1 , 3), (4, '18.08.2018 16:30', 'ЦСКА', 'Арсенал', 3 , 0), (4, '18.08.2018 19:00', 'Краснодар', 'Спартак', 0 , 1 ),(4, '18.08.2018 21:30', 'Ахмат', 'Рубин', 1 , 1 ),(4, '19.08.2018 16:30', 'Крылья Советов', 'Локомотив', 0 , 1 ),(4, '19.08.2018 19:00', 'Зенит', 'Урал', 4 , 1 ),(4, '19.08.2018 21:30', 'Ростов', 'Енисей', 4 , 0), (4, '20.08.2018 19:30', 'Динамо', 'Уфа', 3 , 0), (5, '24.08.2018 19:30', 'Арсенал', 'Ростов', 0 , 1), (5, '25.08.2018 14:00', 'Урал', 'Ахма', 2 , 1 ),(5, '25.08.2018 16:30', 'Рубин', 'ЦСКА', 1 , 1 ),(5, '25.08.2018 19:00', 'Спартак', 'Динамо', 2 , 1 ),(5, '26.08.2018 14:00', 'Оренбург', 'Краснодар', 1 , 1) ,(5, '26.08.2018 16:30', 'Уфа', 'Зенит', 0 , 2) ,(5, '26.08.2018 19:00', 'Локомотив', 'Анжи', 2 , 1) ,(5, '27.08.2018 17:30', 'Енисей', 'Крылья Советов', 1 , 0), (6, '31.08.2018 19:30', 'Ростов', 'Рубин', 1 , 1 ),(6, '01.09.2018 14:00', 'Крылья Советов', 'Анжи', 1 , 0), (6, '01.09.2018 16:30', 'ЦСКА', 'Урал', 4 , 0 ),(6, '01.09.2018 19:00', 'Краснодар', 'Локомотив', 2 , 1) , (6, '02.09.2018 14:00', 'Енисей', 'Арсенал', 0 , 0 ),(6, '02.09.2018 16:30', 'Динамо', 'Оренбург', 2 , 0), (6, '02.09.2018 19:00', 'Зенит', 'Спартак', 0 , 0 ),(6, '02.09.2018 21:30', 'Ахмат', 'Уфа', 2 , 1 ),(7, '14.09.2018 19:30', 'Локомотив', 'Динамо', 1 , 1 ),(7, '15.09.2018 14:00', 'Рубин', 'Енисей', 1 , 0 ),(7, '15.09.2018 16:30', 'Уфа', 'ЦСКА', 0 , 3 ),(7, '15.09.2018 19:00', 'Арсенал', 'Крылья Советов', 4 , 0 ),(7, '16.09.2018 14:00', 'Оренбург', 'Зенит', 1 , 2 ),(7, '16.09.2018 16:30', 'Анжи', 'Краснодар', 0 , 4 ),(7, '16.09.2018 19:00', 'Спартак', 'Ахмат', 1 , 2 ),(7, '17.09.2018 17:30', 'Урал', 'Ростов', 1 , 1 ),(8, '22.09.2018 11:30', 'Енисей', 'Урал', 1 , 2 ),(8, '22.09.2018 14:00', 'Динамо', 'Анжи', 0 , 1), (8, '22.09.2018 16:30', 'Арсенал', 'Рубин', 2 , 2), (8, '22.09.2018 19:00', 'Ростов', 'Уфа', 0 , 0 ),(8, '22.09.2018 19:00', 'Ахмат', 'Оренбург', 1 , 1), (8, '23.09.2018 16:30', 'Зенит', 'Локомотив', 5 , 3 ),
(8, '23.09.2018 19:00', 'ЦСКА', 'Спартак', 1 , 1 ),(8, '24.09.2018 18:30', 'Крылья Советов', 'Краснодар', 0 , 3 ),(9, '28.09.2018 17:30', 'Оренбург', 'ЦСКА', 0 , 1 ),(9, '29.09.2018 11:30', 'Урал', 'Арсенал', 2 , 1 ),(9, '29.09.2018 16:30', 'Уфа', 'Енисей', 2 , 1 ),(9, '29.09.2018 19:00', 'Локомотив', 'Ахмат', 2 , 0 ),(9, '30.09.2018 14:00', 'Анжи', 'Зенит', 2 , 1 ),(9, '30.09.2018 16:30', 'Краснодар', 'Динамо', 3 , 0) ,(9, '30.09.2018 19:00', 'Спартак', 'Ростов', 0 , 1 ),(9, '01.10.2018 19:30', 'Рубин', 'Крылья Советов', 2 , 1), (10, '05.10.2018 19:30', 'Арсенал', 'Уфа', 1 , 1 ),(10, '06.10.2018 14:00', 'Крылья Советов', 'Динамо', 1 , 0) ,(10, '06.10.2018 16:30', 'Ростов', 'Оренбург', 0 , 1) ,(10, '06.10.2018 19:00', 'Рубин', 'Урал', 1 , 0 ),(10, '07.10.2018 11:30', 'Енисей', 'Спартак', 2 , 3) ,(10, '07.10.2018 14:00', 'Ахмат', 'Анжи', 0 , 0) ,(10, '07.10.2018 16:30', 'Зенит', 'Краснодар', 2 , 1), (10, '07.10.2018 19:00', 'ЦСКА', 'Локомотив', 0 , 1) ,(11, '19.10.2018 18:00', 'Анжи', 'ЦСКА', 0 , 2) ,(11, '19.10.2018 20:30', 'Локомотив', 'Ростов', 2 , 1) ,(11, '20.10.2018 11:30', 'Оренбург', 'Енисей', 0 , 0) ,(11, '20.10.2018 14:00', 'Урал', 'Крылья Советов', 1 , 1), (11, '20.10.2018 16:30', 'Уфа', 'Рубин', 0 , 0 ),(11, '21.10.2018 14:00', 'Динамо', 'Зенит', 1 , 0), (11, '21.10.2018 16:30', 'Спартак', 'Арсенал', 2 , 3) ,(11, '21.10.2018 19:00', 'Краснодар', 'Ахмат', 0 , 1) ,(12, '27.10.2018 14:00', 'Урал', 'Уфа', 1 , 1 ),(12, '27.10.2018 16:30', 'Арсенал', 'Оренбург', 2 , 2) ,(12, '27.10.2018 19:00', 'Ростов', 'Анжи', 1 , 0) ,(12, '28.10.2018 14:00', 'Енисей', 'Локомотив', 0 , 3) ,(12, '28.10.2018 16:30', 'Ахмат', 'Динамо', 0 , 0) ,(12, '28.10.2018 19:00', 'ЦСКА', 'Краснодар', 1 , 2) ,(12, '29.10.2018 18:00', 'Крылья Советов', 'Зенит', 0 , 1), (12, '29.10.2018 20:30', 'Рубин', 'Спартак', 1 , 1 ),(13, '03.11.2018 14:00', 'Локомотив', 'Арсенал', 3 , 1), (13, '03.11.2018 16:30', 'Динамо', 'ЦСКА', 0 , 0 ),(13, '04.11.2018 14:00', 'Зенит', 'Ахмат', 1 , 0 ),(13, '04.11.2018 16:30', 'Краснодар', 'Ростов', 2 , 2 ),(13, '04.11.2018 19:00', 'Спартак', 'Урал', 1 , 2 ),(13, '05.11.2018 14:00', 'Оренбург', 'Рубин', 1 , 0) ,(13, '05.11.2018 16:30', 'Уфа', 'Крылья Советов', 1 , 2) ,(13, '05.11.2018 19:00', 'Анжи', 'Енисей', 2 , 1 ),(14, '09.11.2018 19:30', 'Арсенал', 'Анжи', 2 , 0 ),(14, '10.11.2018 14:00', 'Урал', 'Оренбург', 2 , 1 ),(14, '10.11.2018 16:30', 'Крылья Советов', 'Ахмат', 1 , 2) ,(14, '10.11.2018 19:00', 'Ростов', 'Динамо', 0 , 0 ),(14, '11.11.2018 14:00', 'Уфа', 'Спартак', 2 , 0 ),(14, '11.11.2018 16:00', 'Краснодар', 'Енисей', 3 , 0), (14, '11.11.2018 16:30', 'Рубин', 'Локомотив', 0 , 0), (14, '11.11.2018 19:00', 'ЦСКА', 'Зенит', 2 , 0 ),(15, '23.11.2018 18:00', 'Ахмат', 'ЦСКА', 0 , 2 ),(15, '23.11.2018 20:30', 'Локомотив', 'Урал', 1 , 2 ),(15, '24.11.2018 14:00', 'Динамо', 'Енисей', 1 , 2 ),(15, '24.11.2018 16:30', 'Оренбург', 'Уфа', 1 , 0 ),(15, '24.11.2018 19:00', 'Анжи', 'Рубин', 1 , 1 ),(15, '25.11.2018 14:00', 'Спартак', 'Крылья Советов', 3 , 1 ),(15, '25.11.2018 16:30', 'Краснодар', 'Арсенал', 3 , 0 ),(15, '25.11.2018 19:00', 'Зенит', 'Ростов', 2 , 0 ),(16, '30.11.2018 19:30', 'Рубин', 'Динамо', 1 , 1 ),(16, '01.12.2018 14:00', 'Енисей', 'Ахмат', 1 , 1 ),(16, '01.12.2018 19:00', 'Анжи', 'Уфа', 0 , 0 ),
(16, '02.12.2018 14:00', 'Краснодар', 'Урал', 2 , 0), (16, '02.12.2018 16:30', 'Ростов', 'ЦСКА', 0 , 0 ),(16, '02.12.2018 19:00', 'Спартак', 'Локомотив', 2 , 1 ),(16, '03.12.2018 19:30', 'Арсенал', 'Зенит', 4 , 2 ),(17, '08.12.2018 12:30', 'Крылья Советов', 'Ростов', 1 , 0 ),(17, '08.12.2018 15:00', 'ЦСКА', 'Енисей', 2 , 1 ),(17, '08.12.2018 17:30', 'Локомотив', 'Оренбург', 2 , 1 ),(17, '08.12.2018 20:00', 'Анжи', 'Спартак', 0 , 3 ),(17, '09.12.2018 14:00', 'Динамо', 'Урал', 4 , 0 ),(17, '09.12.2018 16:30', 'Краснодар', 'Уфа', 1 , 1) ,(17, '09.12.2018 19:00', 'Зенит', 'Рубин', 1 , 2 ),(17, '10.12.2018 19:30', 'Ахмат', 'Арсенал', 2 , 0 ),(18, '01.03.2019 16:30', 'Оренбург', 'Анжи', 0 , 1 ),(18, '02.03.2019 11:30', 'Урал', 'Зенит', 0 , 1 ),(18, '02.03.2019 14:00', 'Арсенал', 'ЦСКА', 2 , 0), (18, '02.03.2019 16:30', 'Локомотив', 'Крылья Советов', 2 , 2) ,(18, '02.03.2019 19:00', 'Рубин', 'Ахмат', 1 , 0 ),(18, '03.03.2019 11:30', 'Уфа', 'Динамо', 1 , 2), (18, '03.03.2019 14:00', 'Енисей', 'Ростов', 1 , 1), (18, '03.03.2019 19:00', 'Спартак', 'Краснодар', 1 , 1), (19, '09.03.2019 14:00', 'Крылья Советов', 'Енисей', 4 , 0), (19, '09.03.2019 16:30', 'ЦСКА', 'Рубин', 3 , 0 ),(19, '10.03.2019 14:00', 'Ростов', 'Арсенал', 0 , 0), (19, '10.03.2019 16:30', 'Зенит', 'Уфа', 2 , 1 ),(19, '10.03.2019 19:00', 'Динамо', 'Спартак', 0 , 1) ,(19, '10.03.2019 21:00', 'Анжи', 'Локомотив', 0 , 2 ),(19, '11.03.2019 17:30', 'Ахмат', 'Урал', 1 , 1 ),(19, '11.03.2019 19:30', 'Краснодар', 'Оренбург', 2 , 2) ,(20, '15.03.2019 19:30', 'Анжи', 'Крылья Советов', 0 , 2) ,(20, '16.03.2019 11:30', 'Оренбург', 'Динамо', 1 , 0) ,(20, '16.03.2019 14:00', 'Урал', 'ЦСКА', 0 , 1) ,(20, '16.03.2019 16:30', 'Рубин', 'Ростов', 0 , 2) ,(20, '16.03.2019 19:00', 'Арсенал', 'Енисей', 2 , 0) ,(20, '17.03.2019 14:00', 'Уфа', 'Ахмат', 0 , 1) ,(20, '17.03.2019 16:30', 'Локомотив', 'Краснодар', 1 , 0) ,(20, '17.03.2019 19:00', 'Спартак', 'Зенит', 1 , 1) ,(21, '29.03.2019 18:30', 'Крылья Советов', 'Арсенал', 0 , 1) ,(21, '30.03.2019 11:30', 'Енисей', 'Рубин', 1 , 1) ,(21, '30.03.2019 14:00', 'Динамо', 'Локомотив', 0 , 1) ,(21, '30.03.2019 16:30', 'Ахмат', 'Спартак', 1 , 3) ,(21, '30.03.2019 19:00', 'Ростов', 'Урал', 2 , 1) ,(21, '31.03.2019 14:00', 'Зенит', 'Оренбург', 3 , 1), (21, '31.03.2019 16:30', 'ЦСКА', 'Уфа', 2 , 2) ,(21, '31.03.2019 19:00', 'Краснодар', 'Анжи', 5 , 0), (16, '03.04.2019 17:00', 'Оренбург', 'Крылья Советов', 3 , 1) ,(22, '06.04.2019 14:00', 'Анжи', 'Динамо', 1 , 1) ,(22, '06.04.2019 16:30', 'Краснодар', 'Крылья Советов', 1 , 0) ,(22, '06.04.2019 19:00', 'Спартак', 'ЦСКА', 0 , 2)
CREATE VIEW [dbo].[V_MATCH]AS	WITH CTE AS 			(SELECT *,                     CASE                         WHEN total1 > total2 THEN 3                         WHEN total1 = total2 THEN 1                         ELSE 0                     END AS SCORE1,                     CASE                         WHEN total1 < total2 THEN 3                         WHEN total1 = total2 THEN 1                         ELSE 0                     END AS SCORE2             FROM dbo.MATCH			),         CTE2 AS 			(SELECT TUR, TEAM1, TEAM2, TOTAL1, TOTAL2, SCORE1, SCORE2,                     SUM(score1) OVER(PARTITION BY TEAM1) AS OCHKI1,                     SUM(score2) OVER(PARTITION BY TEAM2) AS OCHKI2              --sum(score1) over (PARTITION BY TEAM1 order by TUR) AS NAKOPLENIE1              --sum(score2) over (PARTITION BY TEAM2 order by TUR) AS NAKOPLENIE2
           FROM CTE			)         SELECT *, 				OCHKI1 + OCHKI2 AS total         FROM CTE2 c1;-- where exists (select 1 from CTE2 c2 where c1.TEAM1=c2.TEAM2)
GO